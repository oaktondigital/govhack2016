<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7 lang="en""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8 lang="en""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9 lang="en""> <![endif]-->
<!--[if IE 9]>         <html class="no-js lt-ie10 lang="en""> <![endif]-->
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Place favicon.ico in the root directory -->
    <!-- build:css css/styles.min.css -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="bower_components/components-font-awesome/css/font-awesome.min.css">
    <!-- endbuild -->

</head>
<body>
    <h2>MAPS</h2>

    <button type="button" onclick="showPositions()">Show Positions</button>
    <button type="button" onclick="showCurrentLocation()">Show Current Location</button>
    <br />
    <br />
    <br />
    <div id="googleMap" style="width:500px;height:380px;"></div>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCw5Ps26fT2bt-Lp-b2--2po84rCfWZtTc">
    </script>
    <script>
        var map;
        var infoWindow;

        var xmlhttp = new XMLHttpRequest();
        var url = "http://10.67.0.145:3000/creatures/";


        function initialize() {
            var mapProp = {
                center: new google.maps.LatLng(51.508742, 10.120850),
                zoom: 5,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
            infoWindow = new google.maps.InfoWindow({ map: map });


            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Current location.');
                    map.setCenter(pos);
                }, function () {
                    // handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                //handleLocationError(false, infoWindow, map.getCenter());
            }

        }

        google.maps.event.addDomListener(window, 'load', initialize);

        function showCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Current location.');
                    map.setCenter(pos);
                }, function () {
                    // handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                //handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function getPositions() {
            var positions = [];
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    positions = JSON.parse(xmlhttp.responseText);

                }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
            //return positions;
            return [
           { title: "A", lat: "-35.304758000", lon: "149.122853000" },//,//149.122853,-35.304758
           { title: "B", lat: "-35.304797000", lon: "149.122887000" },
           { title: "C", lat: "-35.304806000", lon: "149.122895000" },
           { title: "D", lat: "-35.305006000", lon: "149.122897000" }
            ];
        }


        function showPositions() {

            markCentenaryTrail();

            var markers = getPositions();

            var infoWindow = new google.maps.InfoWindow(), marker, i;
            var bounds = new google.maps.LatLngBounds();

            // Loop through our array of markers & place each one on the map
            for (i = 0; i < markers.length; i++) {
                var markedPosn = markers[i];
                var position = new google.maps.LatLng(markedPosn.lat, markedPosn.lon);
                bounds.extend(position);
                marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    animation: google.maps.Animation.BOUNCE,
                    title: markedPosn.title
                });

                // Allow each marker to have an info window
                google.maps.event.addListener(marker, 'click', (function (marker, i) {
                    return function () {
                        console.log('m', marker);
                        infoWindow.setContent('<a href="aug.html">link</a>');
                        infoWindow.open(map, marker);
                    }
                })(marker, i));

                map.fitBounds(bounds);
            }
        }

        function markCentenaryTrail() {
            console.log('hey');

            var xhttp = new XMLHttpRequest();
            var pathPoints = [];
            xhttp.onreadystatechange = function () {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    var xmlDoc = xhttp.responseXML;
                    var x = xmlDoc.getElementsByTagName("trkpt");
                    for (i = 0; i < x.length; i++) {
                       
                        pathPoints.push({
                            lat: Number(x[i].getAttribute('lat')), lng: Number(x[i].getAttribute('lon'))
                        });

                    }
                    var path = new google.maps.Polyline({
                        path: pathPoints,
                        geodesic: true,
                        strokeColor: '#FF0000',
                        strokeOpacity: 1.0,
                        strokeWeight: 2
                    });

                    path.setMap(map);
                }
            };
            xhttp.open("GET", "data/walkdata.xml", true);
            xhttp.send();
        }

    </script>
    <!--build:js js/jquery.min.js -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- endbuild -->
    <!--build:js js/main.min.js -->
    <script src="js/main.js"></script>
    <!-- endbuild -->


    <div class="closebutton">
        <a href="aug.html"><i class="fa fa-arrow-circle-right"></i></a>
    </div>
</body>
</html>
